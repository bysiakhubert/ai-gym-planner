---
import Layout from "../layouts/Layout.astro";
import { DashboardView } from "@/components/dashboard/DashboardView";
import type { DashboardResponse } from "@/types";

export const prerender = false;

let dashboardData: DashboardResponse | null = null;
let errorMessage: string | undefined;

try {
  // Fetch dashboard data from API endpoint
  const response = await fetch(new URL("/api/dashboard", Astro.url.origin));

  if (!response.ok) {
    errorMessage = "Nie udało się pobrać danych pulpitu.";
  } else {
    dashboardData = await response.json();
  }
} catch (error) {
  console.error("Dashboard fetch error:", error);
  errorMessage = "Wystąpił błąd podczas ładowania pulpitu.";
}
---

<Layout title="GymPlanner - Pulpit">
  <DashboardView client:load initialData={dashboardData} error={errorMessage} />
</Layout>
